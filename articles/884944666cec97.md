---
title: "Gentoo Linux ã‚’ Hyper-V ä¸Šã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"
emoji: "ğŸ§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["hyperv", "gentoo", "linux"]
published: false
---

# ãªã«ã“ã‚Œ
ã“ã®è¨˜äº‹ã¯ [æœ¨æ›´æ´¥é«˜å°‚ Advent Calendar 2024](https://qiita.com/advent-calendar/2024/nit_kisarazu) å‚åŠ è¨˜äº‹ã§ã™ï¼
å‰æ—¥ã®è¨˜äº‹ã¯ []() ã•ã‚“ã«ã‚ˆã‚‹ []() ã§ã—ãŸï¼
ç¿Œæ—¥ã®è¨˜äº‹ã¯ []() ã•ã‚“ã«ã‚ˆã‚‹ []() ã§ã™ï¼

ä»Šå›ã¯ Gentoo Linux ã‚’ Hyper-V ä¸Šã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã§å‚™å¿˜éŒ²ã¨ã—ã¦ã“ã“ã«æ®‹ã—ã¦ãŠãã¾ã™ï¼
ç§å€‹äººã®ç’°å¢ƒãƒ»æ€æƒ³ã«ã‚ˆã‚‹éƒ¨åˆ†ãŒå¤§ãã„ã®ã§ï¼Œã“ã®è¨˜äº‹ã‚’å‚è€ƒã«ã™ã‚‹éš›ã¯è‡ªå·±è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ï¼

# ä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã®ä½œæˆ
Hyper-V ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ ã‚’é–‹ãï¼
![](https://storage.googleapis.com/zenn-user-upload/18a3b22ff895-20241109.png)

å³ãƒšã‚¤ãƒ³ã® æ“ä½œ â†’  ä»®æƒ³ã‚¹ã‚¤ãƒƒãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼... ã‚’é¸æŠï¼
å¤–éƒ¨ ã‚’é¸æŠã—ã¦ ä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã®ä½œæˆ(S)ï¼
![](https://storage.googleapis.com/zenn-user-upload/bceab0191d7e-20241109.png)

é©å½“ãªåå‰ã‚’ã¤ã‘ã¦ OK(O) ã§é–‰ã˜ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/7c5f157eca8b-20241109.png)

# ä»®æƒ³ãƒã‚·ãƒ³ã®ä½œæˆ

å³ãƒšã‚¤ãƒ³ã® æ“ä½œ â†’  æ–°è¦ â†’ ä»®æƒ³ãƒã‚·ãƒ³(M)... ã‹ã‚‰ ä»®æƒ³ãƒã‚·ãƒ³ã®æ–°è¦ä½œæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ ã‚’èµ·å‹•ï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/ca5476fbb091-20241109.png)

ãŠå¥½ã¿ã§è¨­å®šã‚’å¤‰æ›´ï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/15eafab29eae-20241109.png)

ç¬¬ 2 ä¸–ä»£(2) ã‚’é¸æŠï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/9deb074a28f0-20241109.png)

å‹•çš„ãƒ¡ãƒ¢ãƒªã‚’æœ‰åŠ¹ã«ã™ã‚‹ã®ã§ã¨ã‚Šã‚ãˆãšèµ·å‹•ãƒ¡ãƒ¢ãƒªã¯ 4096MB ã§é€²ã‚ã‚‹ï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/c7025e41f4d7-20241109.png)

å…ˆã»ã©ä½œã£ãŸä»®æƒ³ã‚¹ã‚¤ãƒƒãƒã‚’é¸æŠï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/db496c2da455-20241109.png)

ãŠå¥½ã¿ã§è¨­å®šå¤‰æ›´ï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/bf2de55830c7-20241109.png)

å¾Œã§ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ã‚·ã‚¹ãƒ†ãƒ ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹(L) ã‚’é¸æŠï¼
æ¬¡ã¸(N) > ã§æ¬¡ã«é€²ã‚€ï¼
![](https://storage.googleapis.com/zenn-user-upload/882170029e9e-20241109.png)

å†…å®¹ã‚’ç¢ºèªã™ã‚‹ï¼
OKãªã‚‰ å®Œäº†(F) ã§ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’æŠœã‘ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/ed52d6e491b5-20241109.png)

# Minimal installation CD ã®ãƒ–ãƒ¼ãƒˆ
Minimal installation CD ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’é©å½“ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ãƒŸãƒ©ãƒ¼ã‚µãƒ¼ãƒã‹ã‚‰è½ã¨ã—ã¦ãã‚‹ï¼
https://ftp.jaist.ac.jp/ ã•ã‚“ï¼Œã„ã¤ã‚‚ãŠä¸–è©±ã«ãªã£ã¦ã„ã¾ã™ï¼
ã¤ã„ã§ã« GnuPG ã§ç½²åæ¤œè¨¼ã‚‚è¡Œã†ï¼ãªã‚“ã‹å‡ºåŠ›ãŒæ–‡å­—åŒ–ã‘ã‚’èµ·ã“ã—ã¦ã„ã‚‹...
```powershell:pwsh
~\Downloads\gentoo
> curl -fLO "https://ftp.jaist.ac.jp/pub/Linux/Gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/install-amd64-minimal-20241103T164822Z.iso"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  595M  100  595M    0     0  2546k      0  0:03:59  0:03:59 --:--:-- 4444k

~\Downloads\gentoo
> curl -fLO "https://ftp.jaist.ac.jp/pub/Linux/Gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/install-amd64-minimal-20241103T164822Z.iso.asc"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   488  100   488    0     0     60      0  0:00:08  0:00:08 --:--:--   121

~\Downloads\gentoo
> gpg --keyserver hkps://keys.gentoo.org --recv-keys 13EBBDBEDE7A12775DFDB1BABB572E0E2D182910
gpg: éµBB572E0E2D182910: å…¬é–‹éµ"Gentoo Linux Release Engineering (Automated Weekly Release Key) <releng@gentoo.org>"ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ
gpg:           å‡¦ç†æ•°ã®åˆè¨ˆ: 1
gpg:             ã‚¤ãƒ³ãƒãƒ¼ãƒˆ: 1

~\Downloads\gentoo
> gpg --verify install-amd64-minimal-20241103T164822Z.iso.asc
gpg: ç½²åã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒ'install-amd64-minimal-20241103T164822Z.iso'ã«ã‚ã‚‹ã¨æƒ³å®šã—ã¾ã™
gpg: 2024-11-04 05:21:38 ï¿½ï¿½ï¿½ï¿½ (ï¿½Wï¿½ï¿½ï¿½ï¿½)ã«æ–½ã•ã‚ŒãŸç½²å
gpg:                RSAéµ534E4209AB49EEE1C19D96162C44695DB9F6043Dã‚’ä½¿ç”¨
gpg: "Gentoo Linux Release Engineering (Automated Weekly Release Key) <releng@gentoo.org>"ã‹ã‚‰ã®æ­£ã—ã„ç½²å [ä¸æ˜ã®]
gpg: *è­¦å‘Š*: ã“ã®éµã¯ä¿¡ç”¨ã§ãã‚‹ç½²åã§è¨¼æ˜ã•ã‚Œã¦ã„ã¾ã›ã‚“!
gpg:       ã“ã®ç½²åãŒæ‰€æœ‰è€…ã®ã‚‚ã®ã‹ã©ã†ã‹ã®æ¤œè¨¼æ‰‹æ®µãŒã‚ã‚Šã¾ã›ã‚“ã€‚
 ä¸»éµãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ: 13EB BDBE DE7A 1277 5DFD  B1BA BB57 2E0E 2D18 2910
 å‰¯éµãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ: 534E 4209 AB49 EEE1 C19D  9616 2C44 695D B9F6 043D
```

ä»®æƒ³ãƒã‚·ãƒ³(I) ã§å…ˆã»ã©ä½œã£ãŸä»®æƒ³ãƒã‚·ãƒ³ã‚’é¸æŠã—ï¼Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‹ã‚‰ æ“ä½œ(A) â†’  è¨­å®š(E)... ã‚’é¸æŠï¼
![](https://storage.googleapis.com/zenn-user-upload/e41d198e9c20-20241109.png)

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‹ã‚‰ ã‚»ã‚­ãƒ¥ã‚¢ ãƒ–ãƒ¼ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹(E) ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ï¼
![](https://storage.googleapis.com/zenn-user-upload/e013d7b9a877-20241109.png)

SCSI ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ ã‹ã‚‰ DVD ãƒ‰ãƒ©ã‚¤ãƒ– ã‚’é¸æŠã—ã¦ è¿½åŠ (D) ã‚’é¸æŠï¼
![](https://storage.googleapis.com/zenn-user-upload/eed617dd2848-20241109.png)

ãƒ¡ãƒ‡ã‚£ã‚¢ ã¯ ã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ•ã‚¡ã‚¤ãƒ«(I) ã‚’é¸æŠã—ã¦å…ˆã»ã©ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚»ãƒƒãƒˆï¼
OK(O) ã§é–‰ã˜ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/9e4971c3b12c-20241109.png)

ä»®æƒ³ãƒã‚·ãƒ³ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ èµ·å‹• ã‚’é¸æŠï¼
![](https://storage.googleapis.com/zenn-user-upload/24a2f10a5582-20241109.png)

å°‘ã—å¾…ã¤ã¨ GRUB ãŒèµ·å‹•ã™ã‚‹ã®ã§ãã®ã¾ã¾ç¶šè¡Œï¼
![](https://storage.googleapis.com/zenn-user-upload/932978f132fd-20241109.png)

ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰èµ·å‹•æˆåŠŸï¼
![](https://storage.googleapis.com/zenn-user-upload/1e8e5e8e16c6-20241109.png)

# Gentoo Linux ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
## ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­å®š
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Networking

ã†ã¡ã®å ´åˆã¯ãƒ«ãƒ¼ã‚¿ãŒ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ DHCP ã§é…ã£ã¦ãã‚Œã‚‹ã®ã§ãã‚Œã‚’ç¢ºèªã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/860c9e6a2ab6-20241109.png)

åå‰è§£æ±ºã¨ ping ã®ç–é€šã‚’ç¢ºèªï¼
![](https://storage.googleapis.com/zenn-user-upload/b48eee23463d-20241109.png)

## ãƒ‡ã‚£ã‚¹ã‚¯ã®æº–å‚™
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Disks

ãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ã®ä¸€è¦§ã‚’ç¢ºèªã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/86c2971e4730-20241109.png)

ä»¥ä¸‹ã®å½¢ã« GPT ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚‹ï¼
swap ã«ã¤ã„ã¦ã¯å‹•çš„ãƒ¡ãƒ¢ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã®ã§ã¨ã‚Šã‚ãˆãšè¨­å®šã›ãšï¼Œå…·åˆãŒæ‚ªãã†ã ã£ãŸã‚‰å¾Œã‹ã‚‰`/swapfile`ã‚’ç”¨æ„ã—ã¦å¯¾å¿œã™ã‚‹ã“ã¨ã«ã—ãŸï¼
| Device path (sysfs) | Mount point | File system | Size                  |
| ------------------- | ----------- | ----------- | --------------------- |
| `/dev/sda1`         | `/efi`      | vfat        | 1GiB                  |
| `/dev/sda2`         | `/`         | xfs         | Remainder of the disk |

`/dev/sda`ã«å¯¾ã—ã¦`fdisk`ã‚’èµ·å‹•ã—ã¦ GPT ãƒ‡ã‚£ã‚¹ã‚¯ãƒ©ãƒ™ãƒ«ã‚’ä½œã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/371e3a4e89ba-20241109.png)

EFI ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/ae98758290d5-20241109.png)

ãƒ«ãƒ¼ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/d59ef660096f-20241109.png)

ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèªã—ã¦ä¿å­˜ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/d7dc122094db-20241109.png)

ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/16c550cece67-20241109.png)

ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’ä½œã£ã¦ãƒ«ãƒ¼ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/7f5c2b7f05bf-20241109.png)

## stage ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Stage

ãƒã‚¦ãƒ³ãƒˆã—ãŸå ´æ‰€ã«ç§»å‹•ã—ãŸå¾Œï¼Œæ—¥ä»˜ã®ãšã‚ŒãŒãªã„ã‹ç¢ºèªã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/0351e26486e7-20241109.png)

`links`ã‚’ç”¨ã„ã¦ stage3 ã‚’è½ã¨ã—ã¦ãã‚‹ï¼
init ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦ã¯è‡ªåˆ†ãŒæ…£ã‚Œã¦ã„ã‚‹ systemd ã‚’ä½¿ã†ã“ã¨ã«ã—ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/9cc61c2fb183-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/1c7790a90b16-20241109.png)

ç½²åæ¤œè¨¼ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚è½ã¨ã—ã¦ãŠãï¼ˆæ‹¡å¼µå­ã¯`.asc`ã§ä¿å­˜ã™ã‚‹ï¼‰ï¼
![](https://storage.googleapis.com/zenn-user-upload/02306e80af8b-20241109.png)

GnuPG ã‚’ç”¨ã„ã¦ç½²åã‚’æ¤œè¨¼ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/06686eecff1c-20241109.png)

stage3 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/daa7153c4765-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/8df1d0cd90f9-20241109.png)

`make.conf`ã‚’ã„ã„æ„Ÿã˜ã«è¨­å®šã™ã‚‹ï¼
ã¨ã‚Šã‚ãˆãš`COMMON_FLAGS`ã«`-march=native`ã‚’è¿½åŠ ã—ãŸï¼
`MAKEOPTS`ã«ã¤ã„ã¦ã¯æœªå®šç¾©ã ã¨è‡ªå‹•è¨­å®šã•ã‚Œã‚‹ã®ã§ãã®ã¾ã¾ã«ã—ã¦ãŠã„ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/781c6b09dba9-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/3a43271d3675-20241109.png)

## ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base

DNS æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ chroot ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/94ef0d5367f5-20241109.png)

`/etc/profile`ã‚’`source`ã—ãŸå¾Œï¼Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›´æ–°ã—ã¦ãŠãï¼
![](https://storage.googleapis.com/zenn-user-upload/b5cb952aa707-20241109.png)

EFI ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/2247b20fb4b1-20241109.png)

ãƒªãƒã‚¸ãƒˆãƒªã‚’åŒæœŸã™ã‚‹ï¼
`emerge-webrsync`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä½•æ•…ã‹`unshare: sigprocmask unblock failed: Invalid argument`ã¨è¨€ã‚ã‚Œã¦è½ã¡ã¦ã—ã¾ã†ï¼
![](https://storage.googleapis.com/zenn-user-upload/21c80210545c-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/7aa05184a522-20241109.png)

ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹ï¼
æ—¢ã«é¸æŠæ¸ˆã«ãªã£ã¦ã„ã‚‹ãŒ`default/linux/amd64/23.0/systemd`ã‚’é¸æŠã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/7c28ce8aa855-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/42ac2cc0bae7-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/cfaa72928122-20241109.png)

ãƒŸãƒ©ãƒ¼ã‚µãƒ¼ãƒã‚’è¨­å®šã™ã‚‹ï¼
JAIST ã®ãƒŸãƒ©ãƒ¼ã‚µãƒ¼ãƒã‚’ä½¿ã†ã“ã¨ã«ã—ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/dce82a7ae2a1-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/4f08ddd52335-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/572f0f83f492-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/c310b4350cb6-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/bd7ed8e64da1-20241109.png)

USE ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/30cc7803f05f-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/c1fe72e6bd52-20241109.png)

ãƒ¡ãƒ¢ãƒªãŒå°‘ãªã„ã¨ã“ã®å¾Œã®å‡¦ç†ãŒæ­¢ã¾ã£ã¦ã—ã¾ã†ï¼ˆå‹•çš„ãƒ¡ãƒ¢ãƒªã®å‰²ã‚Šå½“ã¦ãŒã†ã¾ãã§ããªã„ï¼‰ã®ã§`/swapfile`ã‚’ä½œã‚‹ï¼
ã¨ã‚Šã‚ãˆãš 2GiB ã‚’ç¢ºä¿ã—ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/aac5ac6bd95e-20241109.png)

ã†ã©ã‚“ãƒ¯ãƒ¼ãƒ«ãƒ‰ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/3d8260aa7141-20241109.png)

ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¨ãƒ­ã‚±ãƒ¼ãƒ«ã®è¨­å®šã‚’ã™ã‚‹ï¼
`vi`ãŒãªã„ã¨è¨€ã‚ã‚ŒãŸã®ã§`vim`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸï¼
ã‹ã£ã“ã„ã„ã®ã§`en_US.UTF-8`ã‚’ä½¿ã†ï¼
![](https://storage.googleapis.com/zenn-user-upload/782365965a40-20241109.png)
![](https://storage.googleapis.com/zenn-user-upload/6a64a6d3d1d0-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/b1ab026b9e49-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/ca5a5fcbf087-20241110.png)

## Linux ã‚«ãƒ¼ãƒãƒ«ã®è¨­å®š
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel
https://wiki.gentoo.org/wiki/Kernel/Gentoo_Kernel_Configuration_Guide
https://wiki.gentoo.org/wiki/Hyper-V

Linux Firmware ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼
ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«ã¤ã„ã¦åŒæ„ãŒå¿…è¦ãªã®ã§`package.license`ã§è¨±å¯ã™ã‚‹ï¼
ä»®æƒ³ç’°å¢ƒã«ãŠã„ã¦æœ¬å½“ã«ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦ãªã®ã‹ã©ã†ã‹åˆ¤æ–­ã§ããªã‹ã£ãŸï¼
åŸºæœ¬çš„ã«å„ç¨®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¯ä»®æƒ³åŒ–ã•ã‚Œã‚‹ã®ã§ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä¸è¦ãªã®ã§ã¯...ï¼Ÿ
ã¤ã‚ˆã„ã²ã¨ ãŠã—ãˆã¦ãã ã•ã„...
![](https://storage.googleapis.com/zenn-user-upload/7072e3eaabef-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/e263cae0b1e3-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/cfb20ba48c0a-20241110.png)

Microcode ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼
ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«ã¤ã„ã¦åŒæ„ãŒå¿…è¦ãªã®ã§`package.license`ã§è¨±å¯ã™ã‚‹ï¼
ä»®æƒ³ç’°å¢ƒã«ãŠã„ã¦æœ¬å½“ã«ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦ãªã®ã‹ã©ã†ã‹åˆ¤æ–­ã§ããªã‹ã£ãŸï¼
Hyper-V ã¯ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶å‹ä»®æƒ³åŒ–æŠ€è¡“ãªã®ã§ CPU å‘½ä»¤ãŒåŸºæœ¬çš„ã«ã¯ãƒ›ã‚¹ãƒˆ OS ã®é–¢ä¸ãªã—ã«ç›´æ¥å®Ÿè¡Œã•ã‚Œã‚‹ã¨ç†è§£ã—ã¦ã„ã‚‹ï¼
ã‚ˆã£ã¦ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯å¿…è¦ã¨è€ƒãˆã¦ã„ã‚‹ï¼
ã¾ã£ãŸãã‚ã‹ã‚‰ã‚“ ãŠã—ãˆã¦ã¤ã‚ˆã„ã²ã¨...
![](https://storage.googleapis.com/zenn-user-upload/3e015cee9660-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/5b47279299f0-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/7d09721ef2b5-20241110.png)

Installkernel ã‚’è¨­å®šã™ã‚‹ï¼
ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã«ã¯ GRUB ã‚’ï¼Œinitramfs ã®è‡ªå‹•ç”Ÿæˆã«ã¯ dracut ã‚’ä½¿ã†ã“ã¨ã«ã—ãŸã®ã§ USE ãƒ•ãƒ©ã‚°ã¯`grub`ã¨`dracut`ã‚’ç«‹ã¦ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/cc694676c4ec-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/dee7c57b4a89-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/9cc7cc7d1126-20241110.png)

ã‚«ãƒ¼ãƒãƒ«ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/773723c326d9-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/ae3916fac5a0-20241110.png)

ã‚«ãƒ¼ãƒãƒ«ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå ´æ‰€ã«ç§»å‹•ã—ï¼Œ`menuconfig`ã‚’èµ·å‹•ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/af93c61ded37-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/1aae759517ec-20241110.png)

ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹éƒ¨åˆ†ã¯å‰²æ„›ï¼‰ï¼
Hyper-V é–¢é€£ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼
CTF ã§ CAN é€šä¿¡ã®è§£æã‚’è¡Œã†ã“ã¨ãŒã‚ã‚‹ã®ã§é–¢é€£é …ç›®ã¯ã‚«ãƒ¼ãƒãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦æœ‰åŠ¹åŒ–ã—ã¦ãŠãï¼
```
[*] CONFIG_GENTOO_LINUX_INIT_SYSTEMD
[*] CONFIG_XFS_FS
[*] CONFIG_PARTITION_ADVANCED
[*] CONFIG_EFI_PARTITION
[*] CONFIG_FB
[*] CONFIG_FB_EFI
[*] CONFIG_EFIVAR_FS
[*] CONFIG_HYPERV
[*] CONFIG_HYPERV_UTILS
[*] CONFIG_HYPERV_BALLOON
[*] CONFIG_PARAVIRT_SPINLOCKS
[*] CONFIG_VSOCKETS
[*] CONFIG_HYPERV_VSOCKETS
[*] CONFIG_PCI_HYPERV
[*] CONFIG_SCSI_FC_ATTRS
[*] CONFIG_HYPERV_NET
[*] CONFIG_FB_HYPERV
[*] CONFIG_HID_HYPERV_MOUSE
[M] CONFIG_CAN
[M] CONFIG_CAN_VCAN
```

è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ã‚«ãƒ¼ãƒãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼
`make install`ã®æ™‚ã«InstallkernelãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ï¼
![](https://storage.googleapis.com/zenn-user-upload/06f7ebf11fb6-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/d089dbd0ad2a-20241110.png)

## ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®š
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/System

ãƒ‡ãƒã‚¤ã‚¹åã‚’ç¢ºèªã—ï¼Œ`/etc/fstab`ã‚’æ›¸ãï¼
![](https://storage.googleapis.com/zenn-user-upload/1da639f3bd58-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/a2291e4bd340-20241110.png)

ãƒ›ã‚¹ãƒˆåã‚’è¨­å®šã™ã‚‹ï¼
ã¡ãªã¿ã«`arcturus`ã¯ã†ã—ã‹ã„åº§ Î± æ˜Ÿã®å›ºæœ‰åï¼
![](https://storage.googleapis.com/zenn-user-upload/8ffe90072058-20241110.png)

dhcpcd ã‚’å°å…¥ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/9768959f9642-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/a6a81dcf4c56-20241110.png)

rootã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/118028c2a821-20241110.png)

systemdã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/6b332cf4170a-20241110.png)

## ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã‚’è¨­å®šã™ã‚‹
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã™ã‚‹ï¼
https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Bootloader

GRUB ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/691a8161943b-20241110.png)

`grub.cfg`ã‚’ç”Ÿæˆã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/86bb58a427c4-20241110.png)

# ã‚·ã‚¹ãƒ†ãƒ ã®å†èµ·å‹•
ä»®æƒ³ãƒã‚·ãƒ³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã«ã‚ã‚‹ æ“ä½œ(A) â†’  ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³(D)... ã‹ã‚‰ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã™ã‚‹ï¼
ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã§ããŸã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã® ãƒ¡ãƒ‡ã‚£ã‚¢(M) â†’  DVD ãƒ‰ãƒ©ã‚¤ãƒ– ã‚’é¸æŠã—ã¦ Minimal installation CD ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–ã‚Šå‡ºã—ã¦ãŠãï¼
ãã®å¾Œï¼Œèµ·å‹• ã‚’é¸æŠã—ã¦å†åº¦èµ·å‹•ã™ã‚‹ï¼
![](https://storage.googleapis.com/zenn-user-upload/10ee2be18e0a-20241110.png)

GRUB ãŒèµ·å‹•ã—ã¦...
![](https://storage.googleapis.com/zenn-user-upload/ab3a8cda15d6-20241110.png)

ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿ƒã™ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰å®Œäº†ï¼
![](https://storage.googleapis.com/zenn-user-upload/aabfb6eb2a89-20241110.png)

root ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ããŸã‚‰å¾Œã¯ç…®ã‚‹ãªã‚Šç„¼ããªã‚Šã”è‡ªç”±ã«ï¼
ãªã‚“ã‹å‹•çš„ãƒ¡ãƒ¢ãƒªé–¢ä¿‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ãã‚‹ã‘ã©ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ã„ã‚‹è¨¼ã£ã½ã„ã®ã§ãƒ¨ã‚·ï¼
![](https://storage.googleapis.com/zenn-user-upload/4b8688b9481e-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/2196b9d9880e-20241110.png)

ãŠã¾ã‘: ãªã‚“ã‹æ€ªã—ã„ã¨æ€ã£ã¦ã„ãŸã‘ã©ã‚„ã£ã±ã‚Š dhcpcd ãŒæœ‰åŠ¹åŒ–ã§ãã¦ã„ãªã‹ã£ãŸã®ã§æœ‰åŠ¹åŒ–ã—ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/e4212b2a7962-20241110.png)
![](https://storage.googleapis.com/zenn-user-upload/8776df22454c-20241110.png)

# ã•ã„ã”ã«
ã“ã®å¾Œã¯ sshd ã§ã‚‚å‹•ã‹ã—ã¦ Windows å´ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ï¼
æ°—ãŒå‘ã„ãŸã‚‰è¿½è¨˜ã™ã‚‹ã®ã§ãŠæ¥½ã—ã¿ã«ï¼
